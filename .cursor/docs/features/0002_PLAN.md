### 0002 — RTL (Hebrew) Design Fixes Technical Plan

Brief context: Translations and i18n are already implemented. The app sets `html[dir]` and toggles `html.rtl`/`html.ltr` classes via `useI18nDirection`. This plan focuses on CSS/UX corrections for RTL without altering current LTR visuals.

Key direction hook already in code:

- `src/hooks/useI18nDirection.ts` — sets `lang`, `dir`, and toggles `html.rtl`/`html.ltr`
- Consumed in `src/RootLayout.tsx`

Scope: SCSS modules and components where left/right are used (sample from audit):

- Components/pages styles using left/right: `src/components/**.module.scss`, `src/pages/**.module.scss`, and `src/App.scss`. Notable files include:
  - `src/components/NavbarBottom.module.scss`
  - `src/components/Header.module.scss`
  - `src/components/section/Section.module.scss`
  - `src/components/inputs/*Input.module.scss` (Input, TextArea, SearchInput, ControlledInput, Checkbox, RangeInput, ToggleInput, LocationInput, FileInput, AutoComplete)
  - `src/components/profile/*` (DogPreview, ProfileTabs)
  - `src/components/park/*` (ParkHeader, ParkTabs, ReviewsPreview, ParkGenerals)
  - `src/components/modals/*` (AppearModal, BottomModal, NotificationModal, TopModal, FormModal, EnlargeImageModal)
  - `src/components/notifications/*` (NotificationsModal, NotificationItem)
  - `src/components/searchList/SearchListInfiniteItems.module.scss`
  - `src/pages/*` (Login, Profile, Users, UserDog, ParkResolved, UpdatePassword, DeletionConfirmation, About, PrivacyPolicy, Error, Notifications, NewPark)
  - `src/components/parks/*` (ParkPopup, ParksList)
  - `src/components/weather/WeatherButton.module.scss`
  - `src/App.scss`

Phasing overview

- Phase 0 (Foundations): Define project-wide RTL helpers and guardrails.
- Phase 1 (Systematic CSS migration): Convert physical left/right to logical properties (start/end) with zero visual change in LTR.
- Phase 2 (Residual fixes): Correct the cases that logical properties don’t cover (absolute positioning, transforms, icons, carousels, map controls, animations, shadows, inputs, etc.).
- Phase 3 (Verification & regression guard): Visual QA and static checks to prevent regressions.

Phase 0 — Foundations

1. Direction tokens already exist via `html.rtl`/`html.ltr`. We will rely on these to author explicit overrides where logical properties are insufficient.
2. Do not pre-create helpers or mixins. Create a small helper only if a concrete component needs it and it will be used immediately.
3. Decide a small whitelist for intentional physical left/right when required (documented under Phase 3).

Phase 1 — Systematic CSS logical properties migration

Goal: Replace physical properties with logical equivalents to make styles direction-aware without changing LTR visuals.

Execution policy: perform Phase 1 one page at a time to validate changes before continuing (unless you specify otherwise).
Commit policy: do not commit any changes unless explicitly instructed to do so.

Property mapping (authoring rules)

- Spacing
  - margin-left → margin-inline-start
  - margin-right → margin-inline-end
  - padding-left → padding-inline-start
  - padding-right → padding-inline-end
- Borders
  - border-left → border-inline-start
  - border-right → border-inline-end
  - border-left-color/style/width → border-inline-start-(color|style|width)
  - border-right-color/style/width → border-inline-end-(color|style|width)
- Corner radii
  - border-top-left-radius → border-start-start-radius
  - border-top-right-radius → border-start-end-radius
  - border-bottom-left-radius → border-end-start-radius
  - border-bottom-right-radius → border-end-end-radius
- Positioning
  - left → inset-inline-start
  - right → inset-inline-end
  - When both left/right are used to size: prefer inline sizing shorthands (`inset-inline`, `inset-inline-start/end`) or rely on `inset` + width where clearer
- Text alignment & flow
  - text-align: left/right → text-align: start/end
  - float: left/right → float: inline-start/inline-end
  - clear: left/right → clear: inline-start/inline-end
- Backgrounds
  - background-position: left/right → background-position: start/end (or split into `background-position-x: start|end`)
  - background shorthand with positional keywords: expand to explicit logical `background-position` to avoid ambiguity
- Lists
  - list-style-position is unaffected, but `list-style-image` alignment can rely on text alignment; prefer `text-align: start/end`

Algorithm (how to apply)

1. Pick one page (and its co-located styles) and migrate that page only.
2. Replace physical properties with logical ones as per the mapping.
3. For shorthand collisions or complex selectors, split into explicit longhands to avoid side effects.
4. Validate in LTR first (no visual change). Then switch to RTL and verify layout mirrors correctly.
5. Stage changes and pause for review; only commit upon explicit instruction. Continue to the next page only after confirmation.
6. Skip only if a component is known to require physical coordinates (record in whitelist for Phase 2/3).

Edge cases to watch in Phase 1

- Absolute centering using `left: 50%` + `transform: translateX(-50%)`: keep as-is (centering is symmetric). Do not convert this pair.
- When both `left` and `right` exist for stretching, prefer using `inset-inline: 0` with width/constraints where appropriate; otherwise leave for Phase 2.
- Shorthand `border`/`margin` with four values is fine; only convert when explicit left/right subproperties are used.

Phase 2 — Residual RTL fixes (beyond logical properties)

2A) Absolute positioning and transforms

- Hard-coded `left`/`right` for icons, badges, toasts, and close buttons: convert to `inset-inline-start/end`.
- Transforms with `translateX(±…)` used for slide-in/out: provide RTL-aware alternatives using `html.rtl` overrides or SCSS helper mixins to invert X.
- `transform-origin: left/right` has no logical keywords. Use percentages (0%/100%) and override per dir if necessary.

2B) SVGs, icons, and imagery

- Directional icons (arrows, chevrons, play/next/back) should flip in RTL. Plan to use either:
  - Alternate icon assets, or
  - `scaleX(-1)` under `html.rtl` for icons that should mirror
- Do NOT flip brand logos, QR codes, photos, or charts unless explicitly requested.

2C) Carousels and horizontal scrollers

- `react-slick` supports RTL via a prop. Update local carousel component to pass `rtl` based on current language/dir.
- Reassess keyboard/gesture directions (swipe left/right) and arrow placements using logical alignment.

2D) Maps (Leaflet)

- Control positions are configured (e.g., `topleft`, `topright`). Switch positions based on dir to maintain expected UX (start vs end).
- Popup pointer alignment and attributions: ensure logical margins/paddings or dir-based overrides in related SCSS.

2E) Animations and transitions

- Any X-axis motion should be direction-aware. Centralize easing/translate distances in CSS variables, then swap sign under `html.rtl`.

2F) Box-shadows and visual depth

- X-offset in `box-shadow` can imply light direction. If a component relies on a directional shadow for affordance, define `--shadow-x` variable and invert under `html.rtl`.

2G) Inputs and text alignment

- Default text alignment should be `text-align: start` for labels and inputs.
- For fields that must remain LTR (emails, URLs, phone numbers, codes), explicitly force LTR (`dir=ltr` at the element or a dedicated class) and keep alignment consistent.

2H) Pseudo-elements and decorative accents

- `::before/::after` using `left`/`right` or background positions: convert to logical or provide dir-specific overrides.

Phase 3 — Verification and regression guard

3A) Static checks

- Add a CI grep script to fail builds if new SCSS uses `left:`/`right:`/`margin-left`/`padding-right` etc., except in whitelisted files/selectors.
- Document whitelist with clear reason (e.g., absolute centering pairs, third-party overrides).

3B) Visual QA checklist (LTR & RTL)

- High-priority screens: Home, Parks list, Park details (header, tabs, reviews), Profile (tabs, dog preview), Login, Notifications, Modals (all), Search input, Carousels, Map overlays/popups.
- Interactives: toggles, range sliders, checkboxes, toasts, close buttons, nav bars, tabs, horizontal lists.

Implementation plan — step-by-step

1. Phase 1 page-by-page rollout: pick one page, migrate using logical properties only; verify LTR/RTL; stage changes and await explicit approval before committing; repeat. Pause between pages for review unless instructed otherwise.
2. After Phase 1 is completed (or upon your approval), provide the exceptions list so it can be encoded.
3. Implement Phase 2 adjustments:
   - Absolute positions → inline-start/end
   - Carousel `rtl` handling in the carousel wrapper
   - Map control positions based on dir
   - Icon flips and animations via `html.rtl` overrides or mixins
   - Inputs that must be LTR → force `dir=ltr`
4. Add CI/static checks and document whitelist.
5. Run visual QA across target screens in both directions; fix residuals.

Requested input from product/design (exceptions list)
Provide the following after Phase 1 is completed, so we can encode exceptions correctly:

- Icons and imagery
  - Which icons should NEVER flip (e.g., brand logos, badges)?
  - Which directional icons MUST flip (back/next/chevrons, play)?
- Carousels
  - Should slide direction mirror in RTL (most common), or remain LTR?
  - Arrow/button placement preferences (start vs end)?
- Maps
  - Control placements (zoom, attribution): start/end preferences in RTL?
- Text and fields
  - Inputs that must remain LTR (email, URL, phone, codes, coordinates)?
  - Any blocks of Latin text/numbers to keep left-aligned in RTL?
- Shadows and motion
  - Any components where shadow direction is significant and should NOT invert?
  - Any slide-in/out directions that must remain as-is across locales?
- Component-specific
  - Tabs order/indicator expectation in RTL (mirror vs fixed)?
  - Modals: close button alignment (inline-start vs fixed-right)?

Deliverables

- Phase 0: Helpers/mixins and whitelist doc
- Phase 1: Logical property migration across all targeted SCSS files
- Phase 2: Residual corrections (carousels, maps, icons, transforms, inputs)
- Phase 3: CI guard and visual QA sign-off

Notes

- Avoid DOM order reversal. Prefer logical CSS and dir-conditional styles.
- Prefer variables; only introduce mixins/helpers when necessary and used immediately.
